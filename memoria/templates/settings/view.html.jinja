{% extends "base.html.jinja" %}
{% block title %}
    {{ title }}
{% endblock title %}
{% block content %}
    {% include "partials/navbar.html.jinja" %}
    {# Assuming this includes your navigation #}
    <div class="container mt-5">
        {{ bootstrap_messages() }}
        <h1 class="mb-4">Admin Settings</h1>
        {# Changed title for clarity #}
        <div class="row">
            {# Left-hand navigation tabs #}
            <div class="col-md-3">
                <div class="list-group mb-4" id="adminSettingsTabs" role="tablist">
                    <a href="#manage-users"
                       class="list-group-item list-group-item-action active"
                       data-bs-toggle="list"
                       role="tab"
                       aria-controls="manage-users"
                       aria-selected="true">Manage Users</a>
                    <a href="#manage-groups"
                       class="list-group-item list-group-item-action"
                       data-bs-toggle="list"
                       role="tab"
                       aria-controls="manage-groups"
                       aria-selected="false">Manage Groups</a>
                    {# Add other potential admin settings links here if needed later #}
                </div>
            </div>
            {# Right-hand tab content #}
            <div class="col-md-9">
                <div class="tab-content" id="adminSettingsTabsContent">
                    {# Manage Users Tab #}
                    <div class="tab-pane fade show active"
                         id="manage-users"
                         role="tabpanel"
                         aria-labelledby="manage-users-tab">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Manage Users</h5>
                                {# Section for adding a new user #}
                                <h6 class="mt-4 mb-3">Add New User</h6>
                                <form method="post" action="{{ url('admin_add_user') }}">
                                    {% csrf_token %}
                                    {{ bootstrap_form(add_user_form) }}
                                    {{ bootstrap_button(button_type="submit", button_class="btn btn-success", content="Add User") }}
                                </form>
                                <hr class="my-4">
                                {# Section for listing and managing existing users #}
                                <h6 class="mb-3">Existing Users</h6>
                                {% if users %}
                                    <ul class="list-group">
                                        {% for user in users %}
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                {{ user.username }}
                                                {% if not user.is_active %}<span class="badge bg-warning ms-2">Inactive</span>{% endif %}
                                                <div>
                                                    {# Form/Link for managing groups - could be a modal trigger or a separate page link #}
                                                    {# Note: Passing arguments to url() is done by listing them after the URL name #}
                                                    <a href="{{ url('admin_manage_user_groups', pk=user.pk) }}"
                                                       class="btn btn-sm btn-outline-secondary me-2">Manage Groups</a>
                                                    {# Form for deactivating/activating user #}
                                                    <form method="post"
                                                          action="{{ url('admin_toggle_user_active', pk=user.pk) }}"
                                                          class="d-inline-block">
                                                        {% csrf_token %}
                                                        {% if user.is_active %}
                                                            {{ bootstrap_button(button_type="submit", button_class="btn-warning", content="Deactivate") }}
                                                        {% else %}
                                                            {{ bootstrap_button(button_type="submit", button_class="btn-success", content="Activate") }}
                                                        {% endif %}
                                                    </button>
                                                </form>
                                            </div>
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p>No users found.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {# Manage Groups Tab #}
                <div class="tab-pane fade"
                     id="manage-groups"
                     role="tabpanel"
                     aria-labelledby="manage-groups-tab">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Manage Groups</h5>
                            {# Section for adding a new group #}
                            <h6 class="mt-4 mb-3">Add New Group</h6>
                            <form method="post" action="{{ url('admin_add_group') }}">
                                {# Corrected Jinja2 URL syntax #}
                                {% csrf_token %}
                                {{ bootstrap_form(add_group_form) }} {# Corrected Jinja2 form rendering syntax #}
                                <button type="submit" class="btn btn-success">Add Group</button>
                            </form>
                            <hr class="my-4">
                            {# Section for listing and removing existing groups #}
                            <h6 class="mb-3">Existing Groups</h6>
                            {% if groups %}
                                <ul class="list-group">
                                    {% for group in groups %}
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            {{ group.name }}
                                            {# Form for removing group #}
                                            <form method="post"
                                                  action="{{ url('admin_remove_group', pk=group.pk) }}"
                                                  class="d-inline-block">
                                                {% csrf_token %}
                                                {{ bootstrap_button(button_type="submit", button_class="btn btn-sm btn-danger", content="Remove") }}
                                            </form>
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p>No groups found.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
